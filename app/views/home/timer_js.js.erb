(function() {


  var loadScript = function(url, callback) {

  	var script = document.createElement("script");
		script.type = "text/javascript";

	  // If the browser is Internet Explorer.
	  if (script.readyState){
	    script.onreadystatechange = function() {
	      if (script.readyState == "loaded" || script.readyState == "complete"){
	        script.onreadystatechange = null;
	        callback();
	      }
	    };
	  // For any other browser.
	  } else {
	    script.onload = function() {
	      callback();
	    };
	  }

	  script.src = url;
	  document.getElementsByTagName("head")[0].appendChild(script);

  }

	/* This is my app's JavaScript */
	var myAppJavaScript = function($) {

		var options = {
        	enable_app: <%= @option.enable_app %>,
            timer_format: "<%= @option.timer_format %>",
            product_rule: "<%= @option.product_rule %>",
            float_settings: {
                float_enable: <%= @option.float_enable %>,
                float_text: "<%= h(@option.float_text).gsub(/(?:\n\r?|\r\n?)/, '<br>').html_safe %>",
                float_position: "<%= @option.float_position %>",
                float_bg_color: "<%= @option.float_bg_color %>",
                float_text_color: "<%= @option.float_text_color %>",
                float_timer_color: "<%= @option.float_timer_color %>",
                float_border: "<%= @option.float_border %>",
                float_border_radius: "<%= @option.float_border_radius %>",
                float_font_size: "<%= @option.float_font_size %>",
                float_timer_size: "<%= @option.float_timer_size %>"
            },
            low_time_settings: {
                low_time_enable: <%= @option.low_time_enable %>,
                low_time_location: "<%= @option.low_time_location %>",
                low_time_warning: "<%= @option.low_time_warning %>",
                low_time_warning_2: "<%= @option.low_time_warning_2 %>",
                low_time_text: "<%= h(@option.low_time_text).gsub(/(?:\n\r?|\r\n?)/, '<br>').html_safe %>",

                low_time_bar_bg_color: "<%= @option.low_time_bar_bg_color %>",
                low_time_bar_text_color: "<%= @option.low_time_bar_text_color %>",
                low_time_bar_timer_color: "<%= @option.low_time_bar_timer_color %>",
                low_time_bar_border: "<%= @option.low_time_bar_border %>",
                low_time_bar_border_radius: "<%= @option.low_time_bar_border_radius %>",
                low_time_bar_font_size: "<%= @option.low_time_bar_font_size %>",
                low_time_bar_timer_size: "<%= @option.low_time_bar_timer_size %>",

                low_time_view_cart_bg_color: "<%= @option.low_time_view_cart_bg_color %>",
                low_time_view_cart_text_color: "<%= @option.low_time_view_cart_text_color %>",
                low_time_view_cart_border: "<%= @option.low_time_view_cart_border %>",
                low_time_view_cart_border_radius: "<%= @option.low_time_view_cart_border_radius %>",

                low_time_checkout_bg_color: "<%= @option.low_time_checkout_bg_color %>",
                low_time_checkout_text_color: "<%= @option.low_time_checkout_text_color %>",
                low_time_checkout_border: "<%= @option.low_time_checkout_border %>",
                low_time_checkout_border_radius: "<%= @option.low_time_checkout_border_radius %>"
            },
            header_settings: {
                header_enable: <%= @option.header_enable %>,
                header_display: "<%= @option.header_display %>",
                header_low_enable: <%= @option.header_low_enable %>,
                header_low_warning: "<%= @option.header_low_warning %>",
                header_low_animation: "<%= @option.header_low_animation %>",

                header_display1_text_color: "<%= @option.header_display1_text_color %>",
                header_display1_font_size: "<%= @option.header_display1_font_size %>",
                header_display1_padding: "<%= @option.header_display1_padding %>",
                header_display1_margin: "<%= @option.header_display1_margin %>",
                header_display1_low_text_color: "<%= @option.header_display1_low_text_color %>",

                header_display2_text_color: "<%= @option.header_display2_text_color %>",
                header_display2_icon_color: "<%= @option.header_display2_icon_color %>",
                header_display2_font_size: "<%= @option.header_display2_font_size %>",
                header_display2_padding: "<%= @option.header_display2_padding %>",
                header_display2_margin: "<%= @option.header_display2_margin %>",
                header_display2_low_text_color: "<%= @option.header_display2_low_text_color %>",
                header_display2_low_icon_color: "<%= @option.header_display2_low_icon_color %>",

                header_display3_text_color: "<%= @option.header_display3_text_color %>",
                header_display3_icon_color: "<%= @option.header_display3_icon_color %>",
                header_display3_bg_color: "<%= @option.header_display3_bg_color %>",
                header_display3_border: "<%= @option.header_display3_border %>",
                header_display3_border_radius: "<%= @option.header_display3_border_radius %>",
                header_display3_font_size: "<%= @option.header_display3_font_size %>",
                header_display3_padding: "<%= @option.header_display3_padding %>",
                header_display3_margin: "<%= @option.header_display3_margin %>",
                header_display3_low_text_color: "<%= @option.header_display3_low_text_color %>",
                header_display3_low_icon_color: "<%= @option.header_display3_low_icon_color %>",
                header_display3_low_bg_color: "<%= @option.header_display3_low_bg_color %>",
                header_display3_low_border: "<%= @option.header_display3_low_border %>",
                header_display3_low_border_radius: "<%= @option.header_display3_low_border_radius %>",

                header_display4_text_color: "<%= @option.header_display4_text_color %>",
                header_display4_icon_color: "<%= @option.header_display4_icon_color %>",
                header_display4_bg_color: "<%= @option.header_display4_bg_color %>",
                header_display4_border: "<%= @option.header_display4_border %>",
                header_display4_border_radius: "<%= @option.header_display4_border_radius %>",
                header_display4_font_size: "<%= @option.header_display4_font_size %>",
                header_display4_padding: "<%= @option.header_display4_padding %>",
                header_display4_margin: "<%= @option.header_display4_margin %>",
                header_display4_low_text_color: "<%= @option.header_display4_low_text_color %>",
                header_display4_low_icon_color: "<%= @option.header_display4_low_icon_color %>",
                header_display4_low_bg_color: "<%= @option.header_display4_low_bg_color %>",
                header_display4_low_border: "<%= @option.header_display4_low_border %>",
                header_display4_low_border_radius: "<%= @option.header_display4_low_border_radius %>"
            },
            cart_settings: {
                cart_enable: <%= @option.cart_enable %>,
                cart_text: "<%= h(@option.cart_text).gsub(/(?:\n\r?|\r\n?)/, '<br>').html_safe %>",

                cart_bar_bg_color: "<%= @option.cart_bar_bg_color %>",
                cart_bar_text_color: "<%= @option.cart_bar_text_color %>",
                cart_bar_timer_color: "<%= @option.cart_bar_timer_color %>",
                cart_bar_border: "<%= @option.cart_bar_border %>",
                cart_bar_border_radius: "<%= @option.cart_bar_border_radius %>",
                cart_bar_font_size: "<%= @option.cart_bar_font_size %>",
                cart_bar_timer_size: "<%= @option.cart_bar_timer_size %>",
                cart_bar_padding: "<%= @option.cart_bar_padding %>",
                cart_bar_margin: "<%= @option.cart_bar_margin %>",

                cart_continue_bg_color: "<%= @option.cart_continue_bg_color %>",
                cart_continue_text_color: "<%= @option.cart_continue_text_color %>",
                cart_continue_border: "<%= @option.cart_continue_border %>",
                cart_continue_border_radius: "<%= @option.cart_continue_border_radius %>",
                cart_checkout_bg_color: "<%= @option.cart_checkout_bg_color %>",
                cart_checkout_text_color: "<%= @option.cart_checkout_text_color %>",
                cart_checkout_border: "<%= @option.cart_checkout_border %>",
                cart_checkout_border_radius: "<%= @option.cart_checkout_border_radius %>",

                cart_low_enable: <%= @option.cart_low_enable %>,
                cart_low_warning: "<%= @option.cart_low_warning %>",
                cart_bar_low_bg_color: "<%= @option.cart_bar_low_bg_color %>",
                cart_bar_low_text_color: "<%= @option.cart_bar_low_text_color %>",
                cart_bar_low_timer_color: "<%= @option.cart_bar_low_timer_color %>",
                cart_bar_low_border: "<%= @option.cart_bar_low_border %>",
                cart_bar_low_border_radius: "<%= @option.cart_bar_low_border_radius %>",

                cart_continue_low_bg_color: "<%= @option.cart_continue_low_bg_color %>",
                cart_continue_low_text_color: "<%= @option.cart_continue_low_text_color %>",
                cart_continue_low_border: "<%= @option.cart_continue_low_border %>",
                cart_continue_low_border_radius: "<%= @option.cart_continue_low_border_radius %>",
                cart_checkout_low_bg_color: "<%= @option.cart_checkout_low_bg_color %>",
                cart_checkout_low_text_color: "<%= @option.cart_checkout_low_text_color %>",
                cart_checkout_low_border: "<%= @option.cart_checkout_low_border %>",
                cart_checkout_low_border_radius: "<%= @option.cart_checkout_low_border_radius %>"
            },
            quick_view_settings: {
                quick_view_enable: <%= @option.quick_view_enable %>,
                quick_view_text: "<%= h(@option.quick_view_text).gsub(/(?:\n\r?|\r\n?)/, '<br>').html_safe %>",
                quick_view_background_color: "<%= @option.quick_view_background_color %>",
                quick_view_text_color: "<%= @option.quick_view_text_color %>",
                quick_view_timer_color: "<%= @option.quick_view_timer_color %>",
                quick_view_border: "<%= @option.quick_view_border %>",
                quick_view_border_radius: "<%= @option.quick_view_border_radius %>",
                quick_view_font_size: "<%= @option.quick_view_font_size %>",
                quick_view_timer_size: "<%= @option.quick_view_timer_size %>",
                quick_view_padding: "<%= @option.quick_view_padding %>",
                quick_view_margin: "<%= @option.quick_view_margin %>",
                quick_view_low_enable: <%= @option.quick_view_low_enable %>,
                quick_view_low_warning: "<%= @option.quick_view_low_warning %>",
                quick_view_low_background_color: "<%= @option.quick_view_low_background_color %>",
                quick_view_low_text_color: "<%= @option.quick_view_low_text_color %>",
                quick_view_low_timer_color: "<%= @option.quick_view_low_timer_color %>",
                quick_view_low_border: "<%= @option.quick_view_low_border %>",
                quick_view_low_border_radius: "<%= @option.quick_view_low_border_radius %>",
            },
            custom_css: "<%= @option.custom_css.gsub(/(?:\n\r?|\r\n?)/, '') %>"            
		},
		appCSS = options.custom_css;
        console.log(options);

		if (options.enable_app) {
			
            function addMinutes(date, minutes) {
                return new Date(date.getTime() + minutes*60000);
            }

            function getTimeRemaining(endtime){
              var t = Date.parse(endtime) - Date.parse(new Date());
              var seconds = Math.floor( (t/1000) % 60 );
              var minutes = Math.floor( (t/1000/60) % 60 );
              var hours = Math.floor( (t/(1000*60*60)) % 24 );
              var days = Math.floor( t/(1000*60*60*24) );
              return {
                'total': t,
                'days': days,
                'hours': hours,
                'minutes': minutes,
                'seconds': seconds
              };
            }

            var expires = addMinutes(new Date(), 5);

			$('body').append('<style>'+appCSS+'</style>');
		}

	};

	if ((typeof jQuery === 'undefined') || (parseFloat(jQuery.fn.jquery) < 1.7)) {
	  loadScript('//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js', function(){
	    jQuery191 = jQuery.noConflict(true);
	    myAppJavaScript(jQuery191);
	  });
	} else {
	  myAppJavaScript(jQuery);
	}


})();